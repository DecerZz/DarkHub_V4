--[[
    BAD BUSINESS ~ Bye...#0001
]]


--Load UI
local Library = loadstring(game:HttpGet(('https://raw.githubusercontent.com/shlexware/Orion/main/source')))()

local Window = Library:MakeWindow({Name = "DARKHUB V4", HidePremium = false, SaveConfig = true, ConfigFolder = "DARKHUB"})

--Load AntiCheat Bypass

local XOLDC;
XOLDC = hookfunction(getrenv().xpcall,function() return end)
local MSG;

--UI Elements

local Aimbot = Window:MakeTab({
    Name = 'Aimbot'
})

local GunMods = Window:MakeTab({
    Name = 'Gun Mods'
})

local LP_Tab = Window:MakeTab({
    Name = 'LocalPlayer'
})

local Visuals = Window:MakeTab({
    Name = 'Visuals'
})


--Aimbot Tab

Aimbot:AddToggle({
    Name = 'Silent Aim',
    Default = false,
    Flag = 'FF_SilentAim',
    Callback = function() end
})

Aimbot:AddToggle({
    Name = 'Kill Aura',
    Default = false,
    Flag = 'FF_KillAura',
    Callback = function() end
})

Aimbot:AddToggle({
    Name = 'FOV Visible',
    Default = false,
    Flag = 'FF_FOVVIS',
    Callback = function() end
})

Aimbot:AddSlider({
    Name = 'FOV Value',
    Min = 100,
    Max = 750,
    Default = 100,
    Increment = 10,
    Flag = 'FV_FOVVALUE',
    Callback = function() end  
})

Aimbot:AddDropdown({
    Name = 'Hit Part',
    Options = {'Chest', 'Head', 'Random'},
    Default = 'Random',
    Flag = 'FV_HitPart',
    Callback = function() end    
})

--Gun Mods TAB


GunMods:AddToggle({
    Name = 'No Recoil',
    Default = false,
    Flag = 'FF_NoRECOIL',
    Callback = function() end
})

GunMods:AddToggle({
    Name = 'No Spread',
    Default = false,
    Flag = 'FF_NoSPREAD',
    Callback = function() end
})

GunMods:AddToggle({
    Name = 'Rapid Fire',
    Warning = 'May cause some shots to be invalid',
    Default = false,
    Flag = 'FF_RapidFire',
    Callback = function() end
})

GunMods:AddToggle({
    Name = 'WallBang',
    Warning = 'You can only wallbang players close to you',
    Default = false,
    Flag = 'FF_WallBang',
    Callback = function() end
})

--LocalPlayer TAB


LP_Tab:AddSlider({
    Name = 'Sprint Speed',
    Min = 2,
    Max = 10,
    Default = 2,
    Increment = 1,
    Flag = 'FV_SPRINT',
    Callback = function() end
})

LP_Tab:AddToggle({
    Name = 'Gravity Fly',
    Warning = 'This is still a WIP',
    Default = false,
    Flag = 'FF_Fly',
    Callback = function() end
})

LP_Tab:AddToggle({
    Name = 'Chat Spammer',
    Default = false,
    Flag = 'FF_ChatSpam',
    Callback = function() end
})

LP_Tab:AddSlider({
    Name = 'Chat Spam Delay',
    Min = 2,
    Max = 10,
    Default = 2,
    Increment = 1,
    Flag = 'FV_SPAMDELAY',
    Callback = function() end
})

LP_Tab:AddTextbox({
    Name = 'Chat Message',
    Placeholder = 'Enter A Message',
    Default = 'DarkHub Winning',
    Disappear = false,
    Callback = function(C) MSG = C end    
})

--Visuals TAB

Visuals:AddToggle({
    Name = 'Box ESP',
    Default = false,
    Flag = 'FF_BoxESP',
    Callback = function() end
})

Visuals:AddToggle({
    Name = 'Tracer ESP',
    Default = false,
    Flag = 'FF_TracerESP',
    Callback = function() end
})

Visuals:AddToggle({
    Name = 'Names ESP',
    Default = false,
    Flag = 'FF_NameESP',
    Callback = function() end
})

Visuals:AddToggle({
    Name = 'Show Team',
    Default = false,
    Flag = 'FF_TeamESP',
    Callback = function() end
})







--FRAMEWORK

local TS = require(game:GetService("ReplicatedStorage"):WaitForChild("TS"));
local Timer = TS.Timer
local Control = getupvalue(Timer.BindToHeartbeat,1)['Control']
local Raycast = require(game:GetService("ReplicatedStorage").TS).Raycast
local localPlayer = game:GetService("Players").LocalPlayer
local currentCamera = game:GetService("Workspace").CurrentCamera
local Mouse = localPlayer:GetMouse()
local Camera;

local OldRANDOM;
OldRANDOM = hookfunction(getrenv().math.random,function(...)
    local Args = {...}
    if Args[1] == 7 then
        return wait(9e9)
    end
    if tostring(getfenv(2).script) == 'ItemControlScript' and Library.Flags['FF_NoSPREAD'].Value then
        if math.abs(Args[1]) == Args[2] then
            Args[1] = -0.1
            Args[2] = 0.1
            return OldRANDOM(unpack(Args))
        end
    end
    return OldRANDOM(...)
end)

local OldRecoil;
OldRecoil = hookfunction(TS.Camera.Recoil.Update,function(p6, p7)
    if Library.Flags['FF_NoRECOIL'].Value then
        return p6.Value - p6.LastValue;
    end
    return OldRecoil(p6,p7)
end)

OldTIMER = TS.Timer.Wait
TS.Timer.Wait = function(...)
    Args = {...}
    if tostring(getcallingscript()) == 'ItemControlScript' then
        if Library.Flags['FF_RapidFire'].Value then
            Args[2] = 0.01
        end
    end
    return OldTIMER(unpack(Args))
end

--Loop for options

task.spawn(function()
    while task.wait(1) do
        setconstant(Control,tonumber(table.find(getconstants(Control),'Stand'))+1,Library.Flags['FV_SPRINT'].Value)

        if Library.Flags['FF_WallBang'].Value then
            debug.setupvalue(Raycast.CastGeometryAndEnemies, 1, nil)
            debug.setupvalue(Raycast.CastGeometryAndEnemies, 2, nil)
        else
            debug.setupvalue(Raycast.CastGeometryAndEnemies, 1, game:GetService('Workspace').Geometry)
            debug.setupvalue(Raycast.CastGeometryAndEnemies, 2, game:GetService('Workspace').Terrain)
        end
    end
end)


--Chat Spammer

task.spawn(function()
    while true do
        wait(Library.Flags['FV_SPAMDELAY'].Value)
        if Library.Flags['FF_ChatSpam'].Value == true then
            game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(MSG, 'ALL')
            wait(.1)
        end
    end
end)


local function GetAimPart()
    if Library.Flags['FV_HitPart'].Value == 'Random' then
        if math.random(1,3) == 1 then
            return 'Head'
        else
            return 'Chest'
        end
    else
        return Library.Flags['FV_HitPart'].Value
    end
end

--Crappy Gravity Fly / Kill Aura
game:GetService('UserInputService').InputBegan:connect(function(key, gpe)
    if key.KeyCode == Enum.KeyCode.LeftShift then
        Temp_Up = true
    end
    if key.KeyCode == Enum.KeyCode.LeftControl then
        Temp_Down = true
    end
end)
game:GetService('UserInputService').InputEnded:connect(function(key, gpe)
    if key.KeyCode == Enum.KeyCode.LeftShift then
        Temp_Up = false
    end
    if key.KeyCode == Enum.KeyCode.LeftControl then
        Temp_Down = false
    end
end)
spawn(function()
    while true do
        wait()
        pcall(function()
            if Library.Flags['FF_KillAura'].Value then
                for i,v in pairs(GetCharacters()) do
                    local Me = TS.Characters:GetCharacter(game.Players.LocalPlayer)
                    if Me and v.Hitbox and (v.Hitbox.Chest.Position - game.Workspace.CurrentCamera.CFrame.p).Magnitude < 20 then
                       if Me.Backpack.Equipped ~= Me:FindFirstChild('Stab',true).Parent.Parent then
                            for _,v in pairs(game:GetService("ReplicatedStorage"):FindFirstChild('Item',true).Parent:GetChildren()) do
                                if v.Name == "Item" and v.ClassName == "RemoteEvent" then
                                    v:FireServer("Equip", Me:FindFirstChild('Stab',true).Parent.Parent)   
                                end
                            end
                        end
                        local v1 = "StabBegin"
                        local v2 = Me:FindFirstChild('Stab',true).Parent.Parent
                        local event = game:GetService("ReplicatedStorage"):FindFirstChild('Item_Melee',true)

                        event:FireServer(v1, v2)
                        local v1 = "Stab"
                        local v2 = Me:FindFirstChild('Stab',true).Parent.Parent
                        local v3 = v.Hitbox.Chest
                        local v4 = Vector3.new()
                        local v5 = Vector3.new()
                        local event = game:GetService("ReplicatedStorage"):FindFirstChild('Item_Melee',true)
                        
                        event:FireServer(v1, v2, v3, v4, v5)
                    end
                end
            end
            if Library.Flags['FF_Fly'].Value then
                game:GetService("Workspace").Gravity = 0
                Me = TS.Characters:GetCharacter(game.Players.LocalPlayer)
                if Temp_Up == true then
                    Me.Root.Velocity = Vector3.new(0,40,0)
                end
                if Temp_Down == true then
                    Me.Root.Velocity = Vector3.new(0,-40,0)
                end
                if Temp_Down == false and Temp_Up == false then
                    if Me.Root.Velocity.Y ~= 0 then
                        Me.Root.Velocity = Vector3.new(0,0,0)
                    end
                end
            else
                game:GetService("Workspace").Gravity = 110
            end
        end)
    end
end)

--Silent Aim and other shit

function GetCharacters()
    temptable = {}
        for i,v in pairs(game:GetService('Players'):GetPlayers()) do
            if v.Name ~= game:GetService('Players').LocalPlayer.Name and TS.Teams:GetPlayerTeam(v) ~= TS.Teams:GetPlayerTeam(game:GetService('Players').LocalPlayer) then
                temp2 = TS.Characters:GetCharacter(v)
                table.insert(temptable,temp2)
            end
        end
    return temptable
end
function getClosestPlayerToCursor() 
    local closestPlayer = nil
    local shortestDistance = math.huge
        for i, v in pairs(GetCharacters()) do
            if v:FindFirstChild('Body') and v.Body:FindFirstChild('Head') then
                local pos = currentCamera:WorldToViewportPoint(v.Body.Head.Position)
                local magnitude = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).magnitude
                if magnitude < shortestDistance and magnitude <= Library.Flags['FV_FOVVALUE'].Value then
                    closestPlayer = v
                    shortestDistance = magnitude
                end
            end
        end  
    return closestPlayer
end

local getcallingfunction = function(stack)
    return debug.getinfo(stack + 1).func
end
OldIndex = hookfunction(getrawmetatable(game).__index,function(...)
	local Self,Key = ...
	if tostring(Self) == 'Camera' and tostring(Key) == 'CFrame' and tostring(getfenv(2).script) == 'ItemControlScript' then
	    if Library.Flags['FF_SilentAim'].Value and getClosestPlayerToCursor() and tostring(debug.getinfo(getcallingfunction(3)).name) == 'LookVector' then
		    local target = getClosestPlayerToCursor()
            if target then
                Camera = game:GetService('Workspace').CurrentCamera
                if target:FindFirstChild('Body') then
                    local HP = target.Body:FindFirstChild(GetAimPart())
                    if HP then
                        Camera = {
                            CFrame = CFrame.new(Camera.CFrame.p,HP.Position or Vector3.new(0,0,0))
                        }
                    end
                end
                return (Camera.CFrame)
            end
		end
	end
	return OldIndex(...)
end)


--Visuals shit lel

local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.NumSides = 460
FOVCircle.Filled = false
FOVCircle.Transparency = 0.6
FOVCircle.Radius = Library.Flags['FV_FOVVALUE'].Value
FOVCircle.Color = Color3.new(0,255,0)

game:GetService("RunService").Stepped:Connect(function()
    FOVCircle.Position = game:GetService('UserInputService'):GetMouseLocation()
    FOVCircle.Radius = Library.Flags['FV_FOVVALUE'].Value
    if Library.Flags['FF_FOVVIS'].Value then
        FOVCircle.Visible = true
    else
        FOVCircle.Visible = false
    end
end)




function DrawSquare()
    local Box = Drawing.new("Square")
    Box.Color = Color3.fromRGB(190, 190, 0)
    Box.Thickness = 0.5
    Box.Filled = false
    Box.Transparency = 1
    return Box
end

function DrawLine()
    local line = Drawing.new("Line")
    line.Color = Color3.new(190, 190, 0)
    line.Thickness = 0.5
    return line
end

function DrawText()
    local Name = Drawing.new("Text")
    Name.Color = Color3.fromRGB(190, 190, 0)
    Name.Size = 20
    Name.Outline = true
    Name.Center = true
    return Name
end

--Esp Loader

function AddEsp(player)
    local Box = DrawSquare()
    local Tracer = DrawLine()
    local Name = DrawText()
    game:GetService('RunService').Stepped:Connect(function()
        local Z,_ = pcall(function()
            if TS.Characters:GetCharacter(player) == nil or TS.Characters:GetCharacter(player).Health.Value == 0 then
                Box.Visible = false
                Tracer.Visible = false
                Name.Visible = false
            else
                if Library.Flags['FF_TeamESP'].Value then
                    if TS.Teams:GetPlayerTeam(player) == TS.Teams:GetPlayerTeam(game.Players.LocalPlayer) then
                        Box.Color = Color3.fromRGB(0,255,0)
                        Tracer.Color = Color3.fromRGB(0,255,0)
                        Name.Color = Color3.fromRGB(0,255,0)
                    else
                        Box.Color = Color3.fromRGB(255,0,0)
                        Tracer.Color = Color3.fromRGB(255,0,0)
                        Name.Color = Color3.fromRGB(255,0,0)
                    end
                    if TS.Characters:GetCharacter(player).Body:FindFirstChild("Chest") and player.InMenu.Value == false then
                        local RootPosition, OnScreen = game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Chest.Position)
                        local HeadPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Head.Position + Vector3.new(0, 0.5, 0))
                        local LegPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Chest.Position - Vector3.new(0, 4, 0))
                        if Library.Flags['FF_BoxESP'].Value then
                            Box.Visible = OnScreen
                            Box.Size = Vector2.new((2350 / RootPosition.Z) + 2.5, HeadPosition.Y - LegPosition.Y)
                            Box.Position = Vector2.new((RootPosition.X - Box.Size.X / 2) - 1, RootPosition.Y - Box.Size.Y / 2)
                        else
                            Box.Visible = false
                        end
                        if Library.Flags['FF_TracerESP'].Value then
                            Tracer.Visible = OnScreen
                            Tracer.To = Vector2.new(game.Workspace.CurrentCamera.ViewportSize.X / 2, 1000)
                            Tracer.From = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Chest.Position).X - 1, RootPosition.Y - (HeadPosition.Y - LegPosition.Y) / 2)
                        else
                            Tracer.Visible = false
                        end
                        if Library.Flags['FF_NameESP'].Value then
                            Name.Visible = OnScreen
                            Name.Position = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Head.Position).X, game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Head.Position).Y - 40)
                            Name.Text = player.Name
                        else
                            Name.Visible = false
                        end
                    else
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                    if not player then
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                else
                    if TS.Teams:GetPlayerTeam(player) == TS.Teams:GetPlayerTeam(game.Players.LocalPlayer) then
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                    if TS.Teams:GetPlayerTeam(player) ~= TS.Teams:GetPlayerTeam(game.Players.LocalPlayer) then
                        Box.Color = Color3.fromRGB(255,0,0)
                        Tracer.Color = Color3.fromRGB(255,0,0)
                        Name.Color = Color3.fromRGB(255,0,0)
                        if TS.Characters:GetCharacter(player).Body:FindFirstChild("Chest") and player.InMenu.Value == false then
                        local RootPosition, OnScreen = game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Chest.Position)
                        local HeadPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Head.Position + Vector3.new(0, 0.5, 0))
                        local LegPosition = game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Chest.Position - Vector3.new(0, 4, 0))
                        if Library.Flags['FF_BoxESP'].Value then
                            Box.Visible = OnScreen
                            Box.Size = Vector2.new((2350 / RootPosition.Z) + 2.5, HeadPosition.Y - LegPosition.Y)
                            Box.Position = Vector2.new((RootPosition.X - Box.Size.X / 2) - 1, RootPosition.Y - Box.Size.Y / 2)
                        else
                            Box.Visible = false
                        end
                        if Library.Flags['FF_TracerESP'].Value then
                            Tracer.Visible = OnScreen
                            Tracer.To = Vector2.new(game.Workspace.CurrentCamera.ViewportSize.X / 2, 1000)
                            Tracer.From = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Chest.Position).X - 1, RootPosition.Y - (HeadPosition.Y - LegPosition.Y) / 2)
                        else
                            Tracer.Visible = false
                        end
                        if Library.Flags['FF_NameESP'].Value then
                            Name.Visible = OnScreen
                            Name.Position = Vector2.new(game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Head.Position).X, game.Workspace.CurrentCamera:WorldToViewportPoint(TS.Characters:GetCharacter(player).Body.Head.Position).Y - 40)
                            Name.Text = player.Name
                        else
                            Name.Visible = false
                        end
                    else
                        Box.Visible = false
                        Tracer.Visible = false
                        Name.Visible = false
                    end
                        if not player then
                            Box.Visible = false
                            Tracer.Visible = false
                            Name.Visible = false
                        end
                    end
                end
            end
        end)
        if not Z then
            warn(Z,_)
        end
    end)
end
  
for i, v in pairs(game:GetService('Players'):GetPlayers()) do
    if v ~= game:GetService('Players').LocalPlayer then
        AddEsp(v)
    end
end
  
game:GetService('Players').PlayerAdded:Connect(function(player)
    if v ~= game:GetService('Players').LocalPlayer then
        AddEsp(player)
    end
end)
